/* Version 1.0.1, copyright (C) 2017, Siemens AG. All Rights Reserved. */
var SWACServices=SWACServices||{};SWACServices.Cycle=SWACServices.Cycle||function(){var a,b,c,d=null,e=0,f=-1,g=!1,h=[2e3,1e3,500,250,125],i=[!1,!1,!1,!1,!1],j=function(a,b){for(var c=0;c<a.length;c++)if(a[c].freq===b)return{value:a[c].value};return!1},k=function(){c.prototype.timer&&(clearInterval(c.prototype.timer),c.prototype.timer=null)},l=function(a){null!==a&&void 0!==a?(k(),d=a,d.onCycle.subscribe(function(a){b(a)})):d=null};return a=function(a){var j=-1,l=-1,m=null;for(m in c.prototype.groups)c.prototype.groups[m].length>0&&(l=parseInt(m.substr(1)),l>j&&(j=l));j!==f&&(d||-1===f||0>j||a&&g?(g=!1,f=j,null===d&&(k(),f>=0?c.prototype.timer=setInterval(b,h[f]):(i=[!1,!1,!1,!1,!1],e=0))):g=!0)},b=function(b){var d={},h=c.prototype.groups,k={},l=-1,m=0,n=null,o=null,p=null,q=null,r=null;if(b)b=b.data;else for(e+=Math.pow(2,4-f),e>=16&&(e=0,g&&a(!0)),b=[],m=0;m<c.prototype.freqList.length;m++)e%c.prototype.freqList[m]===0&&(b.push({freq:4-m,value:i[m]}),i[m]=!i[m]);for(n in h)if(h.hasOwnProperty(n)&&(o=h[n],o instanceof Array&&(l=parseInt(n.substr(1)),r=j(b,l))))for(m in o)o.hasOwnProperty(m)&&(p=o[m].who,p instanceof c&&(q=p._internal.ownerName,void 0!==d[q]&&d[q]instanceof Array&&void 0!==k[q]||(d[q]=[],k[q]=p),d[q].push({name:o[m].group,freq:l,value:r.value})));for(q in k)k.hasOwnProperty(q)&&k[q].onCycle.fire(d[q])},c=function(b){var e=this,f=c.prototype.groups;"string"!=typeof b&&(b="SWAC_"+SWAC.Guid.generate()),this.beginRegister=function(b,c){var g=null,h=new SWAC.Defer,i=!0,j=null,k=!1;if(("boolean"!=typeof arguments[2]||!arguments[2])&&("string"!=typeof b||"number"!=typeof c||0===b.length||0>c||c>4))return h.reject(new SWAC.Reason("Wrong parameter")),h.promise;void 0!==f["_"+c]&&f["_"+c]instanceof Array||(f["_"+c]=[],k=!0,null!==d&&d.beginRegister(null,c,!0)),g=f["_"+c];for(j in g)if(g[j].group===b&&g[j].who===e){i=!1;break}return i?(g.push({who:e,group:b}),k&&a(),h.fulfill()):h.reject(new SWAC.Reason("Registration ("+b+","+c+") already made")),h.promise},this.beginUnregister=function(b,c){var g=0,h=new SWAC.Defer;if(("boolean"!=typeof arguments[2]||!arguments[2])&&("string"!=typeof b||"number"!=typeof c||0===b.length||0>c||c>4))return h.reject(new SWAC.Reason("Wrong parameter")),h.promise;if(void 0!==f["_"+c]&&f["_"+c]instanceof Array)for(g=0;g<f["_"+c].length;g++)if((null===b||f["_"+c][g].group===b)&&f["_"+c][g].who===e)return f["_"+c].splice(g,1),0===f["_"+c].length&&(delete f["_"+c],null!==d&&d.beginUnregister(null,c,!0),a()),h.fulfill(),h.promise;return h.reject(new SWAC.Reason("Registration not found for group :"+b+" and freq :"+c)),h.promise},this.onCycle="undefined"!=typeof SWAC.Eventing.Event?new SWAC.Eventing.Event("onCycle"):function(){var a=new SWAC.Eventing.Publisher("onCycle");return a.event.fire=function(b){a.notify(b)},a.event}(),this._internal={ownerName:b}},SWAC.Container.onRemoved.subscribe(function(a){var b=null,d=0,e=null;for(b in c.prototype.groups)if(c.prototype.groups.hasOwnProperty(b))for(d in c.prototype.groups[b])c.prototype.groups[b].hasOwnProperty(d)&&(e=c.prototype.groups[b][d].who,e._internal.ownerName===a.data.name&&e.beginUnregister(c.prototype.groups[b][d].group,parseInt(b.substr(1)),!0))}),c.prototype.groups={},c.prototype.freqList=[1,2,4,8,16],c.prototype.timer=null,{local:new c,setParent:l,service:c}}();