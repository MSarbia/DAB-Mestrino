/* Version 1.3.0, copyright (C) 2017, Siemens AG. All Rights Reserved. */
SWAC.Wire=function(a,b,c,d,e,f,g){var h=this,i=a,j=d,k=e,l=f||{},m=b,n=c,o="unwired",p=[],q=[],r=g||{},s=null,t=new SWAC.Eventing.Publisher("onWired"),u=new SWAC.Eventing.Publisher("onUnWired"),v=new SWAC.Eventing.Publisher("onValueChanged"),w=function(a){var b,c,d,e=0;for(a=a||!1,e=p.length-1;e>=0;e--){b=p[e][0],c=p[e][1],d=p[e][2];try{b[c].unsubscribe(d)}catch(f){return!1}}return p=[],q=[],s=null,a||(o="unwired",l.removeOnUnwired&&SWAC.Wiring._internal.remove(h),u.notify({name:i}),SWAC.Wiring._internal.toUnwired(h)),!0},x=function(){var a=!0;return"unwired"!==o&&(a=w()),a=SWAC.Wiring._internal.remove(h)},y=function(a){var b=null;try{b=j?j(q,k,a,r):q}catch(c){if(c instanceof SWAC.Wiring.CancelExecutionException)return l.removeOnFailure?x():w(),void 0;throw l.removeOnFailure?x():w(),c}try{"loose"===o?v.notify(b):s&&s(b)}catch(d){l.removeOnFailure?x():w()}},z=function(a){return function(b){q[a]=b}},A=[],B=function(a){var b,c,d,e=null,f=[],g=function(){return function(a){e=a}},h=function(){return function(a){f.push(a)}},i=0;if(0===a.description.input.length||null===a.description.input||void 0===a.description.input)return null;if(a.description.converter){for(i=0;i<a.description.input.length;i++)if(a.description.input[i].wire){if(-1!==SWAC._internal.Utils.indexOf(A,a.description.input[i].wire))return null;A.push(a.description.input[i].wire),f.push(B(SWAC.Wiring.get({name:a.description.input[i].wire})))}else a.description.input[i].component&&a.description.input[i].dpc?(b=SWAC.Container.get({name:a.description.input[i].component}),d=b.dpc.open(a.description.input[i].dpc),d&&d.beginGet().then(h())):a.description.input[i].custom&&(c="object"==typeof a.description.input[i].custom?a.description.input[i].custom:window[a.description.input[i].custom],d=c.dpc.open(a.description.input[i].dpc),d&&f.push(d.get()));e=a.description.converter(f,a.description.parameter)}else if(a.description.input[0].wire){if(-1!==SWAC._internal.Utils.indexOf(A,a.description.input[0].wire))return null;A.push(a.description.input[0].wire),e=B(SWAC.Wiring.get({name:a.description.input[0].wire}))}else a.description.input[0].component?(b=SWAC.Container.get({name:a.description.input[0].component}),d=b.dpc.open(a.description.input[0].dpc),d&&d.beginGet().then(g())):a.description.input[0].custom&&(c="object"==typeof a.description.input[0].custom?a.description.input[0].custom:window[a.description.input[0].custom],d=c.dpc.open(a.description.input[0].dpc),d&&(e=d.get()));return e},C=function(){var a,b,c,d,e,f,g,j,k,r,u,v,A,C,D=0,E=function(a,b){return function(c){if(b)if(b.beginGet)b.beginGet().then(function(b){q[a]=b;try{y(a)}catch(c){}});else{q[a]=b.get();try{y(a)}catch(d){}}else{q[a]=c.data;try{y(a)}catch(d){}}}};try{var F=function(a){return function(b){z(a)(b),c()}};for(D=0;D<m.length;D++)d=m[D],d.component?(e=SWAC.Container.get({name:d.component}),d.event?-1===d.event.indexOf(".")&&e.proxy[d.event]?(a=E(D),e.proxy[d.event].subscribe(a),p.push([e.proxy,d.event,a]),q.push(null)):-1!==d.event.indexOf(".")&&(r=d.event.substr(d.event.lastIndexOf(".")+1),v=d.event.substr(0,d.event.lastIndexOf(".")),u=SWAC.Wiring._internal.getInterfaceItem(d.component,v),null!==u&&u.intf[r]&&(a=E(D),u.intf[r].subscribe(a),p.push([u.intf,r,a]),q.push(null))):d.dpc&&e.dpc&&(b=e.dpc.open(d.dpc),b&&(c=E(D,b),b.onValueChanged.subscribe(c),p.push([b,"onValueChanged",c]),q.push(null),b.beginGet().then(F(D))))):d.custom?(A="object"==typeof d.custom?d.custom:window[d.custom],d.event&&A[d.event]?(a=E(D),A[d.event].subscribe(a),p.push([A,d.event,a]),q.push(null)):d.dpc&&A.dpc&&(b=A.dpc.open(d.dpc),b&&(c=E(D,b),b.onValueChanged.subscribe(c),p.push([b,"onValueChanged",c]),q.push(null),q[D]=b.get(),c()))):d.wire&&(f=SWAC.Wiring.get({name:d.wire}),g=E(D),f.onValueChanged.subscribe(g),p.push([f,"onValueChanged",g]),q.push(B(f)))}catch(G){return l.removeOnFailure?x():w(),!1}if(n)try{n.component&&n.method?-1===n.method.indexOf(".")?(j=SWAC.Container.get({name:n.component}),s=function(a){a instanceof Array||(a=[a]),j.proxy[n.method].apply(j,a)}):(r=n.method.substr(n.method.lastIndexOf(".")+1),v=n.method.substr(0,n.method.lastIndexOf(".")),u=SWAC.Wiring._internal.getInterfaceItem(n.component,v),null!==u&&(s=function(a){a instanceof Array||(a=[a]),u.intf[r].apply(u.intf,a)})):n.component&&n.dpc?(k=SWAC.Container.get({name:n.component}),s=k.dpc?function(a){k.dpc.open(n.dpc).set(a)}:null):n.custom&&(C="object"==typeof n.custom?n.custom:window[n.custom],n.method?s=function(a){a instanceof Array||(a=[a]),C[n.method].apply(C,a)}:n.dpc&&(s=function(a){C.dpc.open(n.dpc).set(a)})),o="wired",t.notify({name:i}),SWAC.Wiring._internal.toWired(h)}catch(G){return l.removeOnFailure?x():w(),!1}else o="loose",t.notify({name:i,loose:!0}),SWAC.Wiring._internal.toLoose(h);return!0};this.remove=x,this.onWired=t.event,this.onUnwired=u.event,this.onValueChanged=v.event,this._internal={wire:C,unwire:w},this.description={input:m,output:n,name:i,state:function(){return"loose"===o?"wired":o},converter:j,parameter:k,store:r}},SWAC.Wiring=function(){var a,b,c,d={},e={},f={},g=[],h=function(a,b){var c;for(c in g)if(g[c].componentName===a&&g[c].interfaceName===b)return g[c];return null},i=function(a,b){var c;for(c=g.length-1;c>=0;c--)b?g[c].componentName===a&&g[c].interfaceName===b&&g.splice(c,1):g[c].componentName===a&&g.splice(c,1)},j=function(b,c){var d={};b.interfaces.beginGet(c).then(function(e){d=h(b.name(),c),null!==d&&(d.intf=e),a()},function(){i(b.name(),c)})},k=function(a){var b,c,d,f,i,k,l,m,n=0,o={};for(b=a.description.input,n=0;n<b.length;n++)if(c=b[n],c.component){if(d=SWAC.Container.get({name:c.component}),!d)return!1;if(c.event)if(-1===c.event.indexOf(".")){if(!d.proxy[c.event])return!1}else{if(k=c.event.substr(c.event.lastIndexOf(".")+1),l=c.event.substr(0,c.event.lastIndexOf(".")),m=h(c.component,l),null===m)return d.interfaces&&d.interfaces.has(l)&&(o={componentName:c.component,interfaceName:l,intf:null},g.push(o),j(d,l)),!1;if(null===m.intf)return!1;if(!m.intf[k])return!1}else{if(!c.dpc)return!1;if(!d.dpc)return!1;if(f=d.dpc.open(c.dpc),!f)return!1}}else if(c.custom){if(i="object"==typeof c.custom?c.custom:window[c.custom],!i)return!1;if(c.method){if(!i[c.method]||"function"!=typeof i[c.method])return!1}else if(c.event){if(!i[c.event]||"object"!=typeof i[c.event]||!i[c.event].subscribe)return!1}else{if(!c.dpc)return!1;if(!i.dpc)return!1;if(f=i.dpc.open(c.dpc),!f)return!1}}else{if(!c.wire)return!1;if(!e[c.wire])return!1}return!0},l=new SWAC.Eventing.Publisher("onWired"),m=new SWAC.Eventing.Publisher("onUnwired"),n=new SWAC.Eventing.Publisher("onFailure"),o=function(a){a._internal.wire()?l.notify({name:a.description.name}):n.notify({name:a.description.name,message:"Wiring system detected a potential wire, but wiring failed."})},p=function(a){a?a._internal.unwire()?m.notify({name:a.description.name}):n.notify({name:a.description.name,message:"Wiring system detected a invalid wire, but unwiring failed."}):n.notify({name:a.description.name,message:"Wiring system detected a null wire, unwiring failed."})},q=function(){var a,b,f,g,h=function(a){var b;return a?(b=c(a),b||p(a),b):!1};for(a in d)d.hasOwnProperty(a)&&(f=d[a],h(f));for(b in e)e.hasOwnProperty(b)&&(g=e[b],h(g))},r=function(b){var c,d,e,f=function(b){return b?function(){a()}:function(){q()}};if(b.description.input)for(d=0;d<b.description.input.length;d++)e=b.description.input[d].custom,e&&(c="object"==typeof e?e:window[e],c&&c.dpc&&(c.dpc.onAdded.subscribe(f(!0)),c.dpc.onRemoved.subscribe(f(!1))));void 0!==b.description.output&&b.description.output.custom&&(c="object"==typeof b.description.output.custom?b.description.output.custom:window[b.description.output.custom],c&&c.dpc&&(c.dpc.onAdded.subscribe(f(!0)),c.dpc.onRemoved.subscribe(f(!1))))},s=function(a,b,c,d){var e,f,g=[];for(e in a)if(a[e].description[d])if(SWAC._internal.Utils.isArray(a[e].description[d]))for(f in a[e].description[d])a[e].description[d][f][c]===b&&g.push(a[e]);else a[e].description[d][c]===b&&g.push(a[e]);return g},t=function(a){var b,c,d=a.concat();for(b=0;b<d.length;b++)for(c=b+1;c<d.length;c++)d[b]===d[c]&&d.splice(c--,1);return d},u=function(a,b){var c,d=[];for(c in a)a[c]&&a[c].description.name===b&&d.push(a[c]);return d},v=function(a){var b,c=[],g=null,h=null;if(a=a||{wired:!0,unwired:!0,loose:!0},void 0!==a.wired&&null!==a.wired||void 0!==a.loose&&null!==a.loose||void 0!==a.unwired&&null!==a.unwired||(a.wired=a.loose=a.unwired=!0),a.wired)for(var i in d)d.hasOwnProperty(i)&&c.push(d[i]);if(a.loose)for(var j in e)e.hasOwnProperty(j)&&c.push(e[j]);if(a.unwired)for(var k in f)f.hasOwnProperty(k)&&c.push(f[k]);if(a.name&&(c=u(c,a.name)),a.inputComponents&&SWAC._internal.Utils.isArray(a.inputComponents))for(g in a.inputComponents)a.inputComponents.hasOwnProperty(g)&&(c=s(c,a.inputComponents[g],"component","input"));if(a.outputComponents&&SWAC._internal.Utils.isArray(a.outputComponents))for(h in a.outputComponents)a.outputComponents.hasOwnProperty(h)&&(c=s(c,a.outputComponents[h],"component","output"));if(a.inputs&&SWAC._internal.Utils.isArray(a.inputs))for(g in a.inputs)a.inputs.hasOwnProperty(g)&&(b=[],"string"==typeof a.inputs[g]?(b=b.concat(s(c,a.inputs[g],"component","input")),b=b.concat(s(c,a.inputs[g],"wire","input")),c=t(b)):"object"==typeof a.inputs[g]&&(c=a.inputs[g]instanceof SWAC.Component?s(c,a.inputs[g].name(),"component","input"):a.inputs[g]instanceof SWAC.Wire?s(c,a.inputs[g].description.name,"wire","input"):s(c,a.inputs[g],"custom","input")));return a.output&&("string"==typeof a.output?c=s(c,a.output,"component","output"):"object"==typeof a.output&&(c=a.output instanceof SWAC.Component?s(c,a.output.name(),"component","output"):s(c,a.output,"custom","output"))),1===c.length?c[0]:c},w=function(a){var b,c,d=0;if(!a.name||!a.input)return n.notify({name:a.name,message:"Invalid argument(s)"}),!1;if(v({name:a.name})instanceof SWAC.Wire)return n.notify({name:a.name,message:"Wire with this name already exists"}),!1;for(d=0;d<a.input.length;d++){if(!a.input[d].component&&!a.input[d].wire&&!a.input[d].custom)return n.notify({name:a.name,message:"Input component does not exist"}),!1;if(!a.input[d].wire&&!a.input[d].event&&!a.input[d].dpc)return n.notify({name:a.name,message:"Invalid argument(s)"}),!1;if(a.input[d].custom&&(c="object"==typeof a.input[d].custom?a.input[d].custom:window[a.input[d].custom]),c&&a.input[d].event&&(!c[a.input[d].event]||"function"!=typeof c[a.input[d].event].subscribe))return n.notify({name:a.name,message:"Invalid event for javascript object"}),!1}return a.output&&a.output.custom&&(b="object"==typeof a.output.custom?a.output.custom:window[a.output.custom]),a.output&&b&&a.output.method&&(!b[a.output.method]||"function"!=typeof b[a.output.method])?(n.notify({name:a.name,message:"Invalid method for javascript object"}),!1):a.converter&&"function"!=typeof a.converter?(n.notify({name:a.name,message:"Invalid converter type"}),!1):(a.options&&null!==a.options.removeOnFailure&&void 0!==a.options.removeOnFailure||(a.options||(a.options={}),a.options.removeOnFailure=!0),!0)},x=new SWAC.Eventing.Publisher("onCreated"),y=function(b){var c,d=!0,e=0;if(SWAC._internal.Utils.isArray(b)){for(c=new Array(b.length),e=0;e<b.length;e++)c[e]=SWAC.Wiring.create(b[e]),d=d&&c[e];return d}return"object"==typeof b&&null!==b?w(b)?(f[b.name]=new SWAC.Wire(b.name,b.input,b.output,b.converter,b.parameter,b.options,b.store),r(f[b.name]),x.notify({name:b.name}),a(),!0):!1:!1},z=new SWAC.Eventing.Publisher("onRemoved"),A=function(a){var b=a.description.name,c=!0,g=!1;return"unwired"!==a.description.state()&&p(a),void 0!==d[b]&&(delete d[b],g=!0),void 0!==e[b]&&(delete e[b],g=!0),void 0!==f[b]&&(delete f[b],g=!0),g&&z.notify({name:b}),c=g},B=function(b){var c=SWAC.Container.get({name:b}),d=function(b){return b?function(){a()}:function(){q()}};c&&c.dpc&&(c.dpc.onAdded.subscribe(d(!0)),c.dpc.onRemoved.subscribe(d(!1)))},C=function(b){B(b.data.name),a()},D=function(a){i(a.data.name),q()},E=function(a){var b=a.description.name;d[b]=f[b],delete f[b]},F=function(b){var c=b.description.name;e[c]=f[c],delete f[c],a()},G=function(a){var b=a.description.name;d[b]?(f[b]=d[b],delete d[b]):e[b]&&(f[b]=e[b],delete e[b]),q()};!function(){SWAC.Container.onReady.subscribe(C),SWAC.Container.onRemoved.subscribe(D)}();var H=function(a){SWAC.Exception.call(this,a)};return H.prototype=new SWAC.Exception,a=function(){var a="";for(a in f)if(f.hasOwnProperty(a)){var b=f[a];c(b)&&o(b)}},b=function(b){var c,d,e,f,j,k,l={};if(c=b.description.output)if(c.component){if(d=SWAC.Container.get({name:c.component}),!d)return!1;if(c.method)if(-1===c.method.indexOf(".")){if(!d.proxy[c.method])return!1}else{if(f=c.method.substr(c.method.lastIndexOf(".")+1),j=c.method.substr(0,c.method.lastIndexOf(".")),k=h(c.component,j),null===k)return d.interfaces&&d.interfaces.has(j)&&(l={componentName:c.component,interfaceName:j,intf:null},g.push(l),d.interfaces.beginGet(j).then(function(b){l=h(c.component,j),null!==l&&(l.intf=b),a()},function(){i(c.component,j)})),!1;if(null===k.intf)return!1;if(!k.intf[f])return!1}else{if(!c.dpc)return!1;if(!d.dpc)return!1;if(e=d.dpc.open(c.dpc),!e)return!1}}else if(c.custom){if(d="object"==typeof c.custom?c.custom:window[c.custom],!d)return!1;if(c.method){if(!d[c.method]||"function"!=typeof d[c.method])return!1}else{if(!c.dpc)return!1;if(!d.dpc)return!1;if(e=d.dpc.open(c.dpc),!e)return!1}}return!0},c=function(a){return a?a.description.input?k(a)?a.description.output?b(a):!0:!1:!1:!1},{create:y,get:v,onCreated:x.event,onWired:l.event,onUnwired:m.event,onRemoved:z.event,onFailure:n.event,_internal:{remove:A,toWired:E,toUnwired:G,toLoose:F,getInterfaceItem:h},CancelExecutionException:H}}();